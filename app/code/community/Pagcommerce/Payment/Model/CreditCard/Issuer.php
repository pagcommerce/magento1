<?php
class Pagcommerce_Payment_Model_CreditCard_Issuer
{
    function getCardIssuer($cardNumber) {
        $cardNumber = preg_replace('/\D/', '', $cardNumber); // Remove nÃ£o-dÃ­gitos
        $patterns = [
            'visa' => '/^4[0-9]{12}(?:[0-9]{3})?$/',
            'mastercard' => '/^5[1-5][0-9]{14}$/',
            'americanexpress' => '/^3[47][0-9]{13}$/',
            'dinersclub' => '/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/',
            'discover' => '/^6(?:011|5[0-9]{2})[0-9]{12}$/',
            'jcb' => '/^(?:2131|1800|35\d{3})\d{11}$/',
            'maestro' => '/^(5018|5020|5038|6304|6759|6761|6763)\d{8,15}$/',
            'elo' => '/^(4011(78|79)|4312(74|75)|4389(35|36)|4514(16|17)|4576(31|32)|5041(75|76)|5066[09]|5067(00|01)|5090(38|39)|6277(80|81)|6362(97|98)|6363(68|69)|6504(64|65|66)|6505(01|02|03)|6507(09|10|11)|6509(23|24|25)|6516(52|53)|6550(00|01))\d{10}$/',
            'aura' => '/^50(72|41|66|67)(0|1|7|8)(0|1|7|8)\d{10}$/',
            'hipercard' => '/^606282\d{10}(\d{3})?$|^3841\d{15}$/',
            'hiper' => '/^637095(00|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15)\d{10}$/'
        ];
        foreach ($patterns as $issuer => $pattern) {
            if (preg_match($pattern, $cardNumber)) {
                return $issuer;
            }
        }
        return '';
    }
}