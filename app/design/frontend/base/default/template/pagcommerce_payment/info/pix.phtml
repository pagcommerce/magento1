<?php
/** @var Pagcommerce_Payment_Block_Info_Boleto $this */
$data = $this->getInfo()->getAdditionalInformation();
$order = $this->getInfo()->getOrder();
echo "Forma de Pagamento: ".Mage::getStoreConfig('payment/pagcommerce_payment_pix/title').'<br>';

/** @var Pagcommerce_Payment_Helper_Image $helperImage */
$helperImage = Mage::helper('pagcommerce_payment/image');

if($order && $order instanceof Mage_Sales_Model_Order){
    if($order->getState() == $order::STATE_NEW) {
        $payment = $order->getPayment();
        $data = $payment->getMethodInstance()->getInfoInstance()->getAdditionalInformation();
        if (isset($data['pix']['pix_qrcode']) && $data['pix']['pix_qrcode']) {
            $configWidth = Mage::helper('pagcommerce_payment')->getConfig('pix', 'qrcode_width');
            $cssPix = '';
            if($configWidth){
                $cssPix = ' style="width: '.$configWidth.'px"';
            }

            $imgJpg = $helperImage->convertBase64ToImage($data['pix']['pix_qrcode'], $order);

            ?>
            <div style="text-align: left; display: flex; justify-content: left;">
                <img <?php echo $cssPix; ?> src="<?php echo $imgJpg; ?>" alt="Pix QR Code" />
            </div>

            <?php if(Mage::getStoreConfigFlag('payment/pagcommerce_payment_pix/show_link')): ?>
                <div class="tooltip-container">
                    <button id="tooltip-trigger" title="Compartilhar QR Code" type="button">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M8.82122 3.44637C8.7103 3.48079 8.58696 3.5984 7.16425 5.01729C6.31903 5.86155 5.5962 6.59776 5.55796 6.65513C5.50849 6.73006 5.47809 6.81595 5.4694 6.90532C5.46072 6.99469 5.47403 7.08483 5.50815 7.16788C5.54228 7.25093 5.59619 7.32438 5.6652 7.38183C5.73421 7.43927 5.81621 7.47898 5.90407 7.49748C5.99151 7.52148 6.08435 7.51679 6.16892 7.48409C6.30947 7.44393 6.3219 7.43246 7.38033 6.3769L8.45024 5.30986V11.2627L8.51334 11.3889C8.558 11.4799 8.62727 11.5566 8.7133 11.6102C8.79932 11.6638 8.89865 11.6922 9.00001 11.6922C9.10137 11.6922 9.2007 11.6638 9.28672 11.6102C9.37275 11.5566 9.44202 11.4799 9.48668 11.3889L9.54978 11.2627V5.30986L10.6197 6.3769C11.6772 7.4315 11.6906 7.44393 11.8311 7.48409C11.9163 7.51674 12.0098 7.52143 12.0979 7.49748C12.1785 7.48027 12.2543 7.44527 12.3197 7.39503C12.385 7.34479 12.4384 7.28058 12.4757 7.20709C12.5131 7.1336 12.5336 7.05268 12.5357 6.97026C12.5379 6.88783 12.5215 6.80597 12.488 6.73066C12.4507 6.64844 12.0787 6.26121 10.9046 5.08613C10.0613 4.23996 9.32796 3.52286 9.27538 3.49131C9.2066 3.45362 9.13092 3.43021 9.05288 3.42249C8.97484 3.41477 8.89604 3.42289 8.82122 3.44637ZM3.33592 10.6556C3.25288 10.7035 3.18293 10.7711 3.13227 10.8525L3.06056 10.9701L3.05291 12.3345C3.04526 13.894 3.04908 13.9293 3.22692 14.2965C3.45735 14.7707 3.89239 15.1274 4.39913 15.2574C4.55689 15.2976 4.81983 15.3004 9.00001 15.3004C13.1802 15.3004 13.4431 15.2976 13.6009 15.2574C13.8538 15.1907 14.0893 15.0703 14.2916 14.9045C14.4938 14.7387 14.6581 14.5314 14.7731 14.2965C14.9519 13.9284 14.9548 13.894 14.9471 12.3345L14.9404 10.9701L14.8678 10.8525C14.8192 10.7699 14.7497 10.7016 14.6662 10.6544C14.5828 10.6072 14.4884 10.5829 14.3926 10.5839C14.2358 10.5762 14.2128 10.5819 14.0923 10.6556C14.0096 10.7034 13.9397 10.7707 13.8887 10.8516L13.817 10.9692L13.8045 12.3336C13.7959 13.2887 13.7845 13.7161 13.7653 13.7582C13.7024 13.8998 13.5922 14.015 13.4536 14.0842L13.315 14.1531H4.68597L4.54638 14.0842C4.40779 14.015 4.29759 13.8998 4.23468 13.7582C4.21556 13.7161 4.20408 13.2887 4.19548 12.3336L4.184 10.9692L4.11134 10.8525C4.06275 10.7699 3.99323 10.7016 3.9098 10.6544C3.82637 10.6072 3.73198 10.5829 3.63614 10.5839C3.47934 10.5762 3.45639 10.5819 3.33592 10.6556Z" fill="black"/>
                        </svg>
                        <span>Compartilhar QR Code</span>
                    </button>
                    <div class="tooltip-content">
                        <div class="share-list">
                            <?php
                            $shareMessage = "Realize o pagamento para confirmar sua compra!!";
                            ?>

                            <a href="https://api.whatsapp.com/send?text=<?php echo urlencode($shareMessage . "\n\n" . $data['pix']['pix_url']); ?>"
                            target="_blank"
                            class="circle-icon">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M14.3541 3.64713C13.6568 2.94575 12.8273 2.38963 11.9136 2.01094C11 1.63225 10.0203 1.43851 9.03125 1.44094C4.88521 1.44094 1.5073 4.8157 1.5073 8.96175C1.50469 10.2818 1.85091 11.5792 2.51091 12.7225L1.44434 16.6204L5.43361 15.5728C6.53671 16.1736 7.7726 16.489 9.02874 16.4901H9.03189C13.1786 16.4901 16.5527 13.116 16.5552 8.96679C16.5552 6.95767 15.7732 5.06881 14.3541 3.6465V3.64713ZM9.03125 15.2189H9.02874C7.90899 15.2189 6.8098 14.9182 5.84601 14.3481L5.61746 14.2128L3.24883 14.833L3.88096 12.5254L3.73363 12.2893C3.10678 11.2927 2.77497 10.1391 2.77661 8.96175C2.77661 5.51647 5.58283 2.71277 9.03377 2.71277C9.85507 2.71062 10.6686 2.87145 11.4273 3.18595C12.186 3.50046 12.8748 3.96238 13.4537 4.54497C14.0354 5.12478 14.4965 5.81403 14.8104 6.57297C15.1243 7.3319 15.2849 8.14549 15.2828 8.96679C15.2828 12.4152 12.4772 15.2189 9.03125 15.2189ZM12.4595 10.5358C12.2725 10.4426 11.3476 9.98803 11.1757 9.92633C11.0039 9.86211 10.8779 9.83251 10.7526 10.0195C10.6267 10.2084 10.2678 10.6321 10.1576 10.7574C10.0494 10.8802 9.93854 10.8978 9.75154 10.804C9.56265 10.7108 8.95759 10.5112 8.23919 9.86966C7.68072 9.37226 7.30232 8.75523 7.19402 8.56824C7.08321 8.37935 7.18143 8.27861 7.27525 8.18417C7.36087 8.10106 7.46413 7.96569 7.55794 7.85488C7.65113 7.74721 7.68387 7.66851 7.74683 7.54259C7.80853 7.41729 7.77705 7.30648 7.72983 7.2133C7.68324 7.12011 7.30736 6.19268 7.14995 5.81617C6.99695 5.44973 6.84207 5.50136 6.72685 5.49443C6.61855 5.4894 6.49326 5.4894 6.36796 5.4894C6.24204 5.4894 6.03804 5.53599 5.86553 5.7255C5.69364 5.9125 5.20883 6.36772 5.20883 7.292C5.20883 8.21691 5.88253 9.1116 5.97697 9.23752C6.07015 9.3603 7.30232 11.2586 9.18803 12.0733C9.53752 12.2243 9.89481 12.3565 10.2584 12.4694C10.7086 12.6117 11.1191 12.5921 11.444 12.5449C11.8054 12.4914 12.5552 12.0903 12.7126 11.6502C12.8682 11.2126 12.8682 10.8361 12.8209 10.7574C12.7743 10.6787 12.6491 10.6315 12.4595 10.5358Z"/>
                                </svg>
                            </a>

                            <a href="https://www.facebook.com/sharer/sharer.php?u=<?php echo urlencode($data['pix']['pix_url']); ?>"
                                target="_blank"
                                class="circle-icon">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10.8304 1.125C8.613 1.125 7.3125 2.29613 7.3125 4.96463V7.3125H4.5V10.125H7.3125V16.875H10.125V10.125H12.375L12.9375 7.3125H10.125V5.4405C10.125 4.43531 10.4529 3.9375 11.3963 3.9375H12.9375V1.24031C12.6709 1.20431 11.8941 1.125 10.8304 1.125Z"/>
                                </svg>
                            </a>

                            <a href="https://t.me/share/url?url=<?php echo urlencode($shareMessage . "\n\n" . $data['pix']['pix_url']); ?>"
                            target="_blank"
                            class="circle-icon">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9.28721 1.28577C5.107 1.28577 1.71436 4.67841 1.71436 8.85862C1.71436 13.0388 5.107 16.4315 9.28721 16.4315C13.4674 16.4315 16.8601 13.0388 16.8601 8.85862C16.8601 4.67841 13.4674 1.28577 9.28721 1.28577ZM12.801 6.43531C12.6874 7.63182 12.1952 10.5398 11.9453 11.8802C11.8393 12.4482 11.6272 12.6375 11.4303 12.6602C10.9911 12.698 10.6579 12.3724 10.2338 12.0922C9.56741 11.653 9.18873 11.3804 8.54507 10.9563C7.79536 10.4641 8.28002 10.1915 8.71164 9.75219C8.8253 9.63862 10.7639 7.87415 10.8018 7.71512C10.807 7.69103 10.8063 7.66603 10.7997 7.64228C10.7931 7.61852 10.7809 7.59674 10.7639 7.57882C10.7185 7.54095 10.6579 7.55609 10.6049 7.56366C10.5368 7.57881 9.47655 8.28309 7.40914 9.67651C7.10623 9.88094 6.83361 9.98697 6.59128 9.97942C6.31865 9.97179 5.8037 9.82797 5.41748 9.69922C4.94039 9.54777 4.56932 9.46445 4.59961 9.19942C4.61476 9.06305 4.80408 8.92677 5.16001 8.78289C7.37128 7.82114 8.84038 7.18503 9.57496 6.88211C11.6803 6.00366 12.1119 5.85219 12.801 6.43531Z"/>
                                </svg>
                            </a>
                        </div>
                        <button type="button" class="button" id="copy-link" title="Copiar link">Copiar link</button>
                    </div>
                </div>
                <script>
                    jQuery(document).ready(function () {
                        jQuery('#tooltip-trigger').click(function (event) {
                            event.stopPropagation();
                            jQuery('.tooltip-container').toggleClass('active');
                        });

                        jQuery(document).click(function (event) {
                            if (!jQuery(event.target).closest('.tooltip-container .tooltip-content').length) {
                                jQuery('.tooltip-container').removeClass('active');
                            }
                        });

                        jQuery('#copy-link').click(function () {
                            const pixUrl = "<?php echo $data['pix']['pix_url']; ?>";

                            const tempInput = jQuery('<input>');
                            jQuery('body').append(tempInput);
                            tempInput.val(pixUrl).select();
                            document.execCommand('copy');
                            tempInput.remove();

                            var button = jQuery(this);
                            button.text('Copiado');

                            setTimeout(function() {
                                button.text('Copiar link');
                            }, 1500);
                        });
                    });
                </script>
            <?php endif; ?>

            <?php
        }
    }
}

?>